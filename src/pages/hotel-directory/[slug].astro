---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { hotels } from '../../data/hotels';

export function getStaticPaths() {
  return hotels.map(hotel => ({
    params: { slug: hotel.slug },
    props: { hotel },
  }));
}

const { hotel } = Astro.props;
const otherHotels = hotels.filter(h => h.slug !== hotel.slug && h.area === hotel.area).slice(0, 4);
const GYG = 'QW960HO';
const galleryImages = hotel.images?.length ? hotel.images : [hotel.image];
const starWord = hotel.reviewScore ? (hotel.reviewScore >= 9 ? 'Exceptional' : hotel.reviewScore >= 8 ? 'Very Good' : hotel.reviewScore >= 7 ? 'Good' : 'Fair') : '';
---

<BaseLayout title={`${hotel.name} | Banff Hotel Guide`} description={`Detailed guide to ${hotel.name} in ${hotel.area}. ${hotel.avgPrice}. Real reviews, amenities, room info, check-in details, and direct booking links.`}>

  <!-- Hero with gallery -->
  <section class="hotel-hero">
    <div class="hero-gallery">
      <div class="hero-main-img">
        <img src={galleryImages[0]} alt={hotel.name} />
      </div>
      {galleryImages.length > 1 && (
        <div class="hero-side-imgs">
          {galleryImages.slice(1, 5).map((img, i) => (
            <div class="hero-thumb">
              <img src={img} alt={`${hotel.name} - View ${i + 2}`} loading="lazy" />
            </div>
          ))}
        </div>
      )}
    </div>
    <div class="hero-overlay">
      <div class="container">
        <span class="badge">{hotel.area}</span>
        <h1>{hotel.name}</h1>
        <div class="hero-meta">
          <span class="hero-stars">{'‚òÖ'.repeat(hotel.stars)}{'‚òÜ'.repeat(5 - hotel.stars)}</span>
          <span class="hero-sep">¬∑</span>
          <span>{hotel.type}</span>
          <span class="hero-sep">¬∑</span>
          <span>{hotel.priceRange}</span>
          {hotel.reviewScore && (
            <>
              <span class="hero-sep">¬∑</span>
              <span class="hero-review">{hotel.reviewScore}/10 {hotel.reviewLabel || starWord}</span>
            </>
          )}
        </div>
      </div>
    </div>
  </section>

  <!-- Quick booking bar -->
  <div class="booking-strip">
    <div class="container booking-strip-inner">
      <div class="booking-strip-price">
        <span class="strip-label">From</span>
        <span class="strip-price">{hotel.avgPrice.replace('From ', '')}</span>
      </div>
      <a href={hotel.expediaUrl} target="_blank" rel="noopener sponsored" class="btn btn-accent">
        Check Availability on Expedia ‚Üí
      </a>
    </div>
  </div>

  <!-- Main content -->
  <section class="section">
    <div class="container">
      <div class="hotel-layout">
        <div class="hotel-main">

          <!-- Overview -->
          <div class="content-section">
            <h2>Overview</h2>
            {hotel.overview ? (
              <p class="overview-text">{hotel.overview}</p>
            ) : (
              <p class="overview-text">{hotel.description}</p>
            )}
            {hotel.totalRooms && <p class="hotel-stat"><strong>Total rooms:</strong> {hotel.totalRooms}</p>}
            {hotel.yearBuilt && <p class="hotel-stat"><strong>Established:</strong> {hotel.yearBuilt}</p>}
            {hotel.lastRenovated && <p class="hotel-stat"><strong>Last renovated:</strong> {hotel.lastRenovated}</p>}
            {hotel.address && <p class="hotel-stat"><strong>Address:</strong> {hotel.address}</p>}
          </div>

          <!-- Guest reviews callout -->
          {hotel.reviewScore && (
            <div class="review-callout">
              <div class="review-score-box">
                <span class="review-number">{hotel.reviewScore}</span>
                <span class="review-scale">/10</span>
              </div>
              <div class="review-detail">
                <strong>{hotel.reviewLabel || starWord}</strong>
                {hotel.reviewCount && <span class="review-count">Based on {hotel.reviewCount.toLocaleString()} verified guest reviews</span>}
                {hotel.guestLoves && hotel.guestLoves.length > 0 && (
                  <div class="guest-loves">
                    {hotel.guestLoves.map(love => <span class="love-tag">{love}</span>)}
                  </div>
                )}
              </div>
            </div>
          )}

          <!-- Popular amenities -->
          <div class="content-section">
            <h2>Popular Amenities</h2>
            <div class="amenities-grid">
              {(hotel.amenities || hotel.highlights).map(a => (
                <div class="amenity-item">
                  <span class="amenity-icon">‚úì</span>
                  <span>{a}</span>
                </div>
              ))}
            </div>
          </div>

          <!-- Room features -->
          {hotel.roomFeatures && hotel.roomFeatures.length > 0 && (
            <div class="content-section">
              <h2>Room Features</h2>
              <div class="room-features-grid">
                {hotel.roomFeatures.map(f => (
                  <div class="room-feature">
                    <span class="feature-dot"></span>
                    <span>{f}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          <!-- Dining -->
          {hotel.dining && (
            <div class="content-section">
              <h2>Dining</h2>
              <p>{hotel.dining}</p>
            </div>
          )}

          <!-- Location & Nearby -->
          <div class="content-section">
            <h2>Location & Getting Around</h2>
            <p><strong>Area:</strong> {hotel.area}</p>
            <div class="nearby-grid">
              {hotel.nearbyAttractions.map(a => (
                <div class="nearby-item">
                  <span class="nearby-pin">üìç</span>
                  <span>{a}</span>
                </div>
              ))}
            </div>
          </div>

          <!-- Check-in / Check-out -->
          {(hotel.checkIn || hotel.checkOut) && (
            <div class="content-section">
              <h2>Check-in & Check-out</h2>
              <div class="checkin-grid">
                {hotel.checkIn && (
                  <div class="checkin-box">
                    <span class="checkin-label">Check-in</span>
                    <span class="checkin-time">{hotel.checkIn}</span>
                  </div>
                )}
                {hotel.checkOut && (
                  <div class="checkin-box">
                    <span class="checkin-label">Check-out</span>
                    <span class="checkin-time">{hotel.checkOut}</span>
                  </div>
                )}
              </div>
            </div>
          )}

          <!-- Policies -->
          {hotel.policies && (
            <div class="content-section">
              <h2>Good to Know</h2>
              <p>{hotel.policies}</p>
            </div>
          )}

          <!-- Booking tip -->
          <div class="content-section">
            <div class="tip-box">
              <strong>Booking Tip:</strong> Rates at {hotel.name} vary significantly by season. Summer (June-August) is peak season with the highest prices ‚Äî book 3-6 months ahead. Shoulder season (May, September-October) offers lower rates with excellent weather. Winter rates drop except during Christmas, New Year's, and ski season weekends. Always check Expedia for members-only prices and last-minute deals.
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="hotel-sidebar">
          <div class="booking-card">
            <div class="booking-price">{hotel.avgPrice}</div>
            <a href={hotel.expediaUrl} target="_blank" rel="noopener sponsored" class="btn btn-accent booking-btn">
              Check Availability ‚Üí
            </a>
            <p class="booking-note">Prices vary by date. Click to see current rates and member discounts.</p>
          </div>

          <div class="sidebar-card">
            <h3>Quick Facts</h3>
            <div class="fact-row"><span>Rating</span><span>{'‚òÖ'.repeat(hotel.stars)} {hotel.stars}-star</span></div>
            <div class="fact-row"><span>Type</span><span>{hotel.type}</span></div>
            <div class="fact-row"><span>Area</span><span>{hotel.area}</span></div>
            <div class="fact-row"><span>Price</span><span>{hotel.priceRange} ¬∑ {hotel.avgPrice}</span></div>
            {hotel.totalRooms && <div class="fact-row"><span>Rooms</span><span>{hotel.totalRooms}</span></div>}
            {hotel.checkIn && <div class="fact-row"><span>Check-in</span><span>{hotel.checkIn}</span></div>}
            {hotel.checkOut && <div class="fact-row"><span>Check-out</span><span>{hotel.checkOut}</span></div>}
          </div>

          <div class="sidebar-card">
            <h3>Book Banff Experiences</h3>
            <p style="font-size: 0.85rem; color: var(--color-text-light); margin-bottom: 0.75rem;">Guided tours, activities, and day trips from your hotel.</p>
            <a href={`https://www.getyourguide.com/banff-l284/?partner_id=${GYG}`} target="_blank" rel="noopener sponsored" class="btn btn-primary sidebar-btn">Browse Tours ‚Üí</a>
          </div>

          <div class="sidebar-card">
            <h3>Need More Options?</h3>
            <a href="/hotel-directory" class="btn btn-outline sidebar-btn">View All {hotels.length} Hotels ‚Üí</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Related hotels -->
  {otherHotels.length > 0 && (
    <section class="section" style="background: var(--color-bg-alt);">
      <div class="container">
        <div class="section-header">
          <h2>More Hotels in {hotel.area}</h2>
          <p>Compare other options nearby.</p>
        </div>
        <div class="grid grid-4">
          {otherHotels.map(h => (
            <a href={`/hotel-directory/${h.slug}`} class="card">
              <img src={h.image} alt={h.name} class="card-image" style="height: 160px;" loading="lazy" />
              <div class="card-body">
                <span class="mini-stars">{'‚òÖ'.repeat(h.stars)} ¬∑ {h.priceRange}</span>
                <h3 style="font-size: 0.95rem;">{h.name}</h3>
                <p style="font-size: 0.8rem; color: var(--color-text-light);">{h.avgPrice}</p>
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}
</BaseLayout>

<style>
  .hotel-hero { position: relative; }

  .hero-gallery {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 4px;
    max-height: 420px;
    overflow: hidden;
  }

  .hero-main-img img {
    width: 100%;
    height: 420px;
    object-fit: cover;
  }

  .hero-side-imgs {
    display: grid;
    grid-template-rows: repeat(2, 1fr);
    grid-template-columns: repeat(2, 1fr);
    gap: 4px;
  }

  .hero-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .hero-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.8));
    padding: 3rem 0 1.5rem;
    color: white;
  }

  .hero-overlay h1 { color: white; margin-bottom: 0.5rem; }
  .hero-overlay .badge { margin-bottom: 0.5rem; }

  .hero-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
    opacity: 0.9;
    flex-wrap: wrap;
  }

  .hero-sep { opacity: 0.5; }
  .hero-review { color: var(--color-accent); font-weight: 600; }

  .booking-strip {
    background: var(--color-primary);
    color: white;
    padding: 0.75rem 0;
    position: sticky;
    top: 60px;
    z-index: 50;
  }

  .booking-strip-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .strip-label { font-size: 0.8rem; opacity: 0.7; }
  .strip-price { font-family: var(--font-heading); font-size: 1.3rem; font-weight: 700; margin-left: 0.5rem; }

  .hotel-layout {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 2rem;
    align-items: start;
  }

  .content-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }

  .content-section:last-child { border-bottom: none; }

  .content-section h2 {
    font-size: 1.3rem;
    margin-bottom: 1rem;
  }

  .overview-text {
    font-size: 1.02rem;
    line-height: 1.85;
    color: var(--color-text);
  }

  .hotel-stat {
    font-size: 0.9rem;
    margin-top: 0.5rem;
    color: var(--color-text-light);
  }

  .review-callout {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    padding: 1.25rem;
    background: #f0f7f0;
    border-radius: var(--radius);
    margin-bottom: 2.5rem;
    border-left: 4px solid var(--color-primary);
  }

  .review-score-box {
    background: var(--color-primary);
    color: white;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    text-align: center;
    min-width: 70px;
    flex-shrink: 0;
  }

  .review-number { font-size: 1.5rem; font-weight: 700; }
  .review-scale { font-size: 0.8rem; opacity: 0.7; }

  .review-detail strong { display: block; font-size: 1.05rem; margin-bottom: 0.25rem; }
  .review-count { font-size: 0.85rem; color: var(--color-text-light); }

  .guest-loves { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem; }
  .love-tag {
    background: white;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 20px;
    padding: 0.2rem 0.6rem;
    font-size: 0.78rem;
    color: var(--color-primary);
    font-weight: 500;
  }

  .amenities-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.6rem;
  }

  .amenity-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.92rem;
    padding: 0.4rem 0;
  }

  .amenity-icon { color: var(--color-accent); font-weight: 700; }

  .room-features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
  }

  .room-feature {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
  }

  .feature-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--color-primary);
    flex-shrink: 0;
  }

  .nearby-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    margin-top: 0.75rem;
  }

  .nearby-item {
    display: flex;
    gap: 0.5rem;
    font-size: 0.9rem;
  }

  .nearby-pin { font-size: 0.85rem; }

  .checkin-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .checkin-box {
    background: var(--color-bg-alt);
    border-radius: var(--radius);
    padding: 1rem;
    text-align: center;
  }

  .checkin-label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--color-text-light);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.25rem;
  }

  .checkin-time {
    font-family: var(--font-heading);
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-primary);
  }

  .tip-box {
    background: #fef9e7;
    border-left: 4px solid var(--color-accent);
    border-radius: var(--radius);
    padding: 1rem 1.25rem;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .booking-card {
    background: var(--color-primary);
    color: var(--color-white);
    border-radius: var(--radius);
    padding: 1.5rem;
    text-align: center;
    margin-bottom: 1.5rem;
    position: sticky;
    top: 120px;
  }

  .booking-price {
    font-family: var(--font-heading);
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }

  .booking-btn {
    width: 100%;
    display: block;
    text-align: center;
  }

  .booking-note {
    font-size: 0.78rem;
    opacity: 0.7;
    margin-top: 0.75rem;
  }

  .sidebar-card {
    background: var(--color-white);
    border-radius: var(--radius);
    padding: 1.25rem;
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
  }

  .sidebar-card h3 { font-size: 1rem; margin-bottom: 0.75rem; }

  .fact-row {
    display: flex;
    justify-content: space-between;
    padding: 0.45rem 0;
    border-bottom: 1px solid rgba(0,0,0,0.06);
    font-size: 0.85rem;
  }

  .fact-row:last-child { border-bottom: none; }
  .fact-row span:first-child { color: var(--color-text-light); }
  .fact-row span:last-child { font-weight: 600; }

  .sidebar-btn {
    width: 100%;
    display: block;
    text-align: center;
    font-size: 0.9rem;
  }

  .mini-stars { font-size: 0.78rem; color: var(--color-accent); }

  @media (max-width: 768px) {
    .hero-gallery { grid-template-columns: 1fr; }
    .hero-side-imgs { display: none; }
    .hero-main-img img { height: 280px; }
    .hotel-layout { grid-template-columns: 1fr; }
    .booking-card { position: static; }
    .amenities-grid, .room-features-grid, .nearby-grid, .checkin-grid { grid-template-columns: 1fr; }
    .booking-strip-inner { flex-direction: column; text-align: center; }
  }
</style>
